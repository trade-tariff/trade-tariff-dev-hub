<div class="govuk-width-container">
  <div class="govuk-grid-row">
    <div class="govuk-grid-column-full">
      <h1 class="govuk-heading-l">Organisations</h1>

      <%= govuk_table do |table|
        table.with_head do |head|
          head.with_row do |row|
            row.with_cell do
              sort_link_for('Name', 'name', current_column: @sort_column, current_direction: @sort_direction)
            end
            row.with_cell(text: 'Users')
            row.with_cell(text: 'API Keys')
            row.with_cell(text: 'Trade Tariff Keys')
            row.with_cell(text: 'Invitations')
            row.with_cell do
              sort_link_for('Created', 'created_at', current_column: @sort_column, current_direction: @sort_direction)
            end
            row.with_cell(text: '')
          end
        end

        @organisations.each do |org|
          table.with_body do |body|
            body.with_row do |row|
              row.with_cell(header: true, text: org.organisation_name)
              row.with_cell(text: org.users.count)
              row.with_cell(text: org.api_keys.count)
              row.with_cell(text: org.trade_tariff_keys.count)
              row.with_cell(text: org.invitations.pending.count)
              row.with_cell(text: org.created_at.strftime('%d %b %Y'))
              row.with_cell do
                link_to 'View', admin_organisation_path(org), class: 'govuk-link'
              end
            end
          end
        end
      end %>

      <%== pagy_nav(@pagy) if @pagy.pages > 1 %>
    </div>
  </div>
</div>
