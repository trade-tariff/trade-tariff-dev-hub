<div class="govuk-width-container">
  <div class="govuk-grid-row">
    <div class="govuk-grid-column-full">
      <p class="govuk-body">
        <%= link_to '← Back to organisations', admin_organisations_path, class: 'govuk-link' %>
      </p>
      <h1 class="govuk-heading-l"><%= @organisation.organisation_name %></h1>

      <%= govuk_summary_list do |summary_list| %>
        <%- summary_list.with_row do |row| %>
          <% row.with_key(text: 'Organisation name') %>
          <% row.with_value(text: @organisation.organisation_name) %>
        <%- end %>

        <%- summary_list.with_row do |row| %>
          <% row.with_key(text: 'Created on') %>
          <% row.with_value(text: @organisation.created_at.strftime('%d %B %Y')) %>
        <%- end %>
      <% end %>

      <h2 class="govuk-heading-m">Members (<%= @users.count %>)</h2>
      <%= govuk_table do |table|
        table.with_head do |head|
          head.with_row do |row|
            row.with_cell(text: 'Email address')
            row.with_cell(text: 'Created')
          end
        end
        table.with_body do |body|
          @users.each do |user|
            body.with_row do |row|
              row.with_cell(header: true, text: user.email_address)
              row.with_cell(text: user.created_at.strftime('%d %b %Y'))
            end
          end
        end
      end %>

      <h2 class="govuk-heading-m">API Keys (<%= @api_keys.count %>)</h2>
      <%= govuk_table do |table|
        table.with_head do |head|
          head.with_row do |row|
            row.with_cell(text: 'Description')
            row.with_cell(text: 'Status')
            row.with_cell(text: 'Created')
            row.with_cell(text: 'Actions')
          end
        end
        table.with_body do |body|
          @api_keys.each do |key|
            body.with_row do |row|
              row.with_cell(header: true, text: key.description)
              row.with_cell(text: key.enabled? ? 'Active' : 'Revoked')
              row.with_cell(text: key.created_at.strftime('%d %b %Y'))
              row.with_cell do
                if key.enabled?
                  link_to 'Revoke', revoke_api_key_path(key), method: :patch, class: 'govuk-link', data: { confirm: 'Are you sure you want to revoke this API key?' }
                else
                  "Revoked"
                end
              end
            end
          end
        end
      end %>

      <h2 class="govuk-heading-m">OTT Keys (<%= @ott_keys.count %>)</h2>
      <%= govuk_table do |table|
        table.with_head do |head|
          head.with_row do |row|
            row.with_cell(text: 'Description')
            row.with_cell(text: 'Created')
            row.with_cell(text: 'Actions')
          end
        end
        table.with_body do |body|
          @ott_keys.each do |key|
            body.with_row do |row|
              row.with_cell(header: true, text: key.description)
              row.with_cell(text: key.created_at.strftime('%d %b %Y'))
              row.with_cell do
                link_to 'Revoke', revoke_ott_key_path(key), method: :patch, class: 'govuk-link', data: { confirm: 'Are you sure you want to revoke this OTT key? This action cannot be undone.' }
              end
            end
          end
        end
      end %>

      <h2 class="govuk-heading-m">Invitations (<%= @invitations.count %>)</h2>
      <%= govuk_table do |table|
        table.with_head do |head|
          head.with_row do |row|
            row.with_cell(text: 'Invitee')
            row.with_cell(text: 'Status')
            row.with_cell(text: 'Created')
          end
        end
        table.with_body do |body|
          @invitations.each do |invitation|
            body.with_row do |row|
              row.with_cell(header: true, text: invitation.invitee_email)
              row.with_cell(text: invitation.status.capitalize)
              row.with_cell(text: invitation.created_at.strftime('%d %b %Y'))
            end
          end
        end
      end %>
    </div>
  </div>
</div>
