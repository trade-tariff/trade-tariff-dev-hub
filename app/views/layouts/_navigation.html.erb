<% if respond_to?(:current_user) && current_user.present? %>
  <%# Check if user's actual organisation is admin, not the viewed/assumed organisation %>
  <% is_admin = current_user&.organisation&.admin? %>
  <% viewed_org = organisation %>

  <%= header.with_navigation_item(text: "Your Organisation Account", href: organisation_path(current_user.organisation)) %>

  <% if is_admin %>
    <%= header.with_navigation_item(text: "All Organisations", href: admin_organisations_path, active: current_page?(admin_organisations_path)) %>
    <%= header.with_navigation_item(text: "Access Requests", href: admin_role_requests_path, active: current_page?(admin_role_requests_path)) %>
  <% end %>

  <%# Service role navigation (visible to admins AND users with those roles) %>
  <%# Use viewed_org for role checks (if viewing as another org, check that org's roles) %>
  <% if is_admin || viewed_org&.has_role?("fpo:full") %>
    <%= header.with_navigation_item(text: "FPO Keys", href: api_keys_path, active: current_page?(api_keys_path)) %>
  <% end %>

  <% if false %>
    <%= header.with_navigation_item(text: "Trade Tariff Keys", href: trade_tariff_keys_path, active: current_page?(trade_tariff_keys_path)) %>
  <% end %>

  <%# Common navigation (everyone sees these) %>
  <%= header.with_navigation_item(text: "Sign Out", href: logout_path, active: false) %>
<% end %>
